# HTTPS

http 明文传输有被窃听、篡改、冒充的风险。

## SSL/TLS

安全套接层（Secure Sockets Layer）是传输层安全 (Transport Layer Security)的前身。

### 握手涉及四次通信

1. 客户端（通常是浏览器）先向服务器发出加密通信的请求（ClientHello）.
  * 提供支持的加密通信协议版本（如 TLS 1.2）
  * 支持的加密方法（如 RSA）
  * 生成的随机数1（后续用于生成秘钥）等。

2. 服务器收到客户端请求后，向客户端发出回应（ServerHello）。
  * 确认使用的加密通信协议版本
  * 使用的加密算法
  * 生成的随机数2（后续用于生成秘钥）
  * 数字证书

3. 客户端验证收到的数字证书，用 CA 公钥（客户端有证书管理器维护“受信任的根证书颁发机构”）解密，从证书中取出服务器公钥。然后响应服务器。
  * 用公钥加密的随机数3
  * 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送
  * 客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验。

4. 服务器最后响应
  * 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送
  * 服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供客户端校验。

然后双方都可以根据事先商议的加密算法加密三个随机数，生成**会话秘钥**。 后续的通信都用会话秘钥来加解密。

### 关键点

* 第二步中的数字证书保证传到客户端的服务器公钥是受信任的。
* 只用服务器公钥加密一次（非对称加密），确保第三个随机数的加密传输， 因此第三个随机数是确保后续通信安全的关键。
* 后续传输都是对称加密（通过会话秘钥）。


## 参考

* [图解SSL/TLS协议](http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html)
* [SSL/TLS协议运行机制的概述](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)
* [数字签名是什么？](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)