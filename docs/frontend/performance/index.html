<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端性能优化 | tombstone</title>
    <meta name="description" content="tombstone docs">
    <link rel="icon" href="/tombstone/favicon.ico">
    
    <link rel="preload" href="/tombstone/assets/css/0.styles.0ea869b6.css" as="style"><link rel="preload" href="/tombstone/assets/js/app.d26b1760.js" as="script"><link rel="preload" href="/tombstone/assets/js/2.152d0674.js" as="script"><link rel="preload" href="/tombstone/assets/js/4.42483a9f.js" as="script"><link rel="prefetch" href="/tombstone/assets/js/10.1435e313.js"><link rel="prefetch" href="/tombstone/assets/js/11.45c6315d.js"><link rel="prefetch" href="/tombstone/assets/js/12.35639c41.js"><link rel="prefetch" href="/tombstone/assets/js/13.907efca9.js"><link rel="prefetch" href="/tombstone/assets/js/14.5e257679.js"><link rel="prefetch" href="/tombstone/assets/js/15.96da719e.js"><link rel="prefetch" href="/tombstone/assets/js/16.b17c67c6.js"><link rel="prefetch" href="/tombstone/assets/js/17.0770498c.js"><link rel="prefetch" href="/tombstone/assets/js/18.ff68e5de.js"><link rel="prefetch" href="/tombstone/assets/js/19.4478d0fb.js"><link rel="prefetch" href="/tombstone/assets/js/20.cc79339b.js"><link rel="prefetch" href="/tombstone/assets/js/21.3a1be36f.js"><link rel="prefetch" href="/tombstone/assets/js/22.4f0117a3.js"><link rel="prefetch" href="/tombstone/assets/js/23.d8df64fb.js"><link rel="prefetch" href="/tombstone/assets/js/24.bc7737cf.js"><link rel="prefetch" href="/tombstone/assets/js/25.939838a9.js"><link rel="prefetch" href="/tombstone/assets/js/26.6b360fb3.js"><link rel="prefetch" href="/tombstone/assets/js/27.7a429a76.js"><link rel="prefetch" href="/tombstone/assets/js/28.83c7d9ff.js"><link rel="prefetch" href="/tombstone/assets/js/29.b6e9eede.js"><link rel="prefetch" href="/tombstone/assets/js/3.2fdeffe4.js"><link rel="prefetch" href="/tombstone/assets/js/30.66304771.js"><link rel="prefetch" href="/tombstone/assets/js/31.e8802427.js"><link rel="prefetch" href="/tombstone/assets/js/5.5fdc8fc0.js"><link rel="prefetch" href="/tombstone/assets/js/6.4dea053d.js"><link rel="prefetch" href="/tombstone/assets/js/7.826394e6.js"><link rel="prefetch" href="/tombstone/assets/js/8.6a3b416d.js"><link rel="prefetch" href="/tombstone/assets/js/9.002fbdbb.js">
    <link rel="stylesheet" href="/tombstone/assets/css/0.styles.0ea869b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tombstone/" class="home-link router-link-active"><!----> <span class="site-name">tombstone</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tombstone/about.html" class="nav-link">about</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tombstone/about.html" class="nav-link">about</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tombstone/" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/tombstone/handbook/" class="sidebar-heading clickable"><span>手册</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group depth-0"><a href="/tombstone/frontend/" class="sidebar-heading clickable router-link-active open"><span>前端技术清单</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tombstone/frontend/browser/howbrowserworks.html" class="sidebar-link">浏览器是怎么工作的</a></li><li><a href="/tombstone/frontend/performance/" class="active sidebar-link">前端性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#发送请求" class="sidebar-link">发送请求</a></li><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#服务端响应" class="sidebar-link">服务端响应</a></li><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#页面解析与处理" class="sidebar-link">页面解析与处理</a></li><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#页面静态资源" class="sidebar-link">页面静态资源</a></li><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#运行时" class="sidebar-link">运行时</a></li><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#预加载" class="sidebar-link">预加载</a></li><li class="sidebar-sub-header"><a href="/tombstone/frontend/performance/#参考文章" class="sidebar-link">参考文章</a></li></ul></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/tombstone/frontend/javascript/" class="sidebar-heading clickable"><span>JavaScript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tombstone/frontend/javascript/howjsworks.html" class="sidebar-link">JS 是怎么工作的</a></li><li><a href="/tombstone/frontend/javascript/crossorigin.html" class="sidebar-link">浏览器同源策略与 ajax 跨域方法</a></li><li><a href="/tombstone/frontend/javascript/jsapi.html" class="sidebar-link">JS API</a></li><li><a href="/tombstone/frontend/javascript/dom.html" class="sidebar-link">DOM</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/tombstone/frontend/css/" class="sidebar-heading clickable"><span>CSS</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tombstone/frontend/css/cssom.html" class="sidebar-link">CSSOM</a></li><li><a href="/tombstone/frontend/css/csslayout.html" class="sidebar-link">CSS 布局</a></li><li><a href="/tombstone/frontend/css/bfc.html" class="sidebar-link">Block Formatting Context</a></li></ul></section></li><li><a href="/tombstone/frontend/security/" class="sidebar-link">前端安全问题</a></li><li><a href="/tombstone/frontend/typescript/" class="sidebar-link">TypeScript</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/tombstone/frontend/library/" class="sidebar-heading clickable"><span>前端框架</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tombstone/frontend/library/react.html" class="sidebar-link">React</a></li><li><a href="/tombstone/frontend/library/redux.html" class="sidebar-link">Redux</a></li><li><a href="/tombstone/frontend/library/reactimvc.html" class="sidebar-link">React-IMVC</a></li><li><a href="/tombstone/frontend/library/immer.html" class="sidebar-link">Immer</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/tombstone/frontend/tools/" class="sidebar-heading clickable"><span>工程化与工具</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tombstone/frontend/tools/babel.html" class="sidebar-link">Babel</a></li></ul></section></li></ul></section></li><li><a href="/tombstone/blog/" class="sidebar-link">文章</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端性能优化"><a href="#前端性能优化" aria-hidden="true" class="header-anchor">#</a> 前端性能优化</h1> <h2 id="缓存"><a href="#缓存" aria-hidden="true" class="header-anchor">#</a> 缓存</h2> <ul><li><p>本地数据缓存</p> <ul><li>单页应用内存数据缓存</li> <li>cookie, localStorage / sessionStorage, indexedDB</li></ul></li> <li><p>Service Worker</p> <ul><li>独立线程， 请求拦截</li> <li>可以让我们自由控制缓存哪些文件、如何匹配缓存、如何读取缓存，并且缓存是持续性的</li></ul></li> <li><p>Memory Cache</p> <ul><li>Network Size 显示 from memory cache</li> <li>高效，持续时间短， 关闭 tab 页之后缓存失效</li></ul></li> <li><p>Disk Cache</p> <ul><li>Network Size 显示 from disk cache</li> <li>缓存到硬盘，容量大</li></ul></li> <li><p>Push Cache</p> <ul><li>HTTP/2 推送的资源</li></ul></li> <li><p>缓存 HTTP Header 设置</p> <ul><li><p>强缓存相关的有 Expires 和 Cache-Control, NetWork 中可以看到 200（from memory cache 或 from disk cache）</p></li> <li><p>Expires</p> <ul><li><code>expires: Wed, 02 Oct 2019 06:16:30 GMT</code></li> <li>指定资源到期时间， 是 HTTP/1 的产物</li></ul></li> <li><p>Cache-Control</p> <ul><li><p>HTTP/1.1 的产物， 与 Expires 同时存在时优先级高于 Expires</p></li> <li><p>例: <code>cache-control: max-age=600</code>, 单位为秒</p></li> <li><p>详细取值</p> <p><img src="/tombstone/assets/img/cacheControl1.a4a8d7cf.jpg" alt="cache-control"></p> <p><img src="/tombstone/assets/img/cacheControl2.19a12d3a.jpg" alt="cache-control"></p></li></ul></li> <li><p>协商缓存是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程</p> <ul><li>协商缓存生效，返回304，Not Modified</li> <li>协商缓存失效，返回200和请求结果</li> <li>通过 Last-Modified / If-Modified-Since 或 ETag / If-None-Match 设置</li></ul></li> <li><p>Last-Modified / If-Modified-Since</p> <ul><li>response header: <code>last-modified: Mon, 30 Sep 2019 16:46:39 GMT</code></li> <li>request header: <code>if-modified-since: Mon, 30 Sep 2019 16:46:39 GMT</code></li> <li>浏览器下一次请求这个资源，浏览器检测到有 Last-Modified这个header，于是添加If-Modified-Since这个header，值就是Last-Modified中的值；服务器再次收到这个资源请求，会根据 If-Modified-Since 中的值与服务器中这个资源的最后修改时间对比，如果没有变化，返回304和空的响应体，直接从缓存读取，如果If-Modified-Since的时间小于服务器中这个资源的最后修改时间，说明文件有更新，于是返回新的资源文件和200</li> <li>弊端
<ul><li>如果本地打开缓存文件，即使没有对文件进行修改，但还是会造成 Last-Modified 被修改，服务端不能命中缓存导致发送相同的资源</li> <li>因为 Last-Modified 只能以秒计时，如果在不可感知的时间内修改完成文件，那么服务端会认为资源还是命中了，不会返回正确的资源</li></ul></li></ul></li> <li><p>ETag / If-None-Match</p> <ul><li>response header: <code>etag: W/&quot;5d92316f-1a7d1&quot;</code></li> <li>request header: <code>if-none-match: W/&quot;5d92316f-1a7d1&quot;</code></li> <li>Etag是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，只要资源有变化，Etag就会重新生成。</li></ul></li> <li><p>Last-Modified 与 ETag 对比</p> <ul><li>在精确度上，Etag要优于Last-Modified。 Last-Modified的时间单位是秒，如果某个文件在1秒内改变了多次，那么他们的Last-Modified其实并没有体现出来修改，但是Etag每次都会改变确保了精度；如果是负载均衡的服务器，各个服务器生成的Last-Modified也有可能不一致。</li> <li>在性能上，Etag要逊于Last-Modified，毕竟Last-Modified只需要记录时间，而Etag需要服务器通过算法来计算出一个hash值。</li> <li>在优先级上，服务器校验优先考虑Etag。</li></ul></li></ul></li> <li><p>http 缓存流程</p> <p><img src="/tombstone/assets/img/cache.eceb16f9.png" alt="cache"></p></li></ul> <h2 id="发送请求"><a href="#发送请求" aria-hidden="true" class="header-anchor">#</a> 发送请求</h2> <ul><li>避免多余重定向</li> <li>DNS 预解析
<ul><li><code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//yourwebsite.com&quot;&gt;</code></li></ul></li> <li>预先建立连接
<ul><li><code>&lt;link rel=&quot;preconnect&quot; href=&quot;//sample.com&quot;&gt;</code></li></ul></li> <li>使用 CDN</li></ul> <p><img src="/tombstone/assets/img/timing.76198e07.png" alt="timing"></p> <h2 id="服务端响应"><a href="#服务端响应" aria-hidden="true" class="header-anchor">#</a> 服务端响应</h2> <ul><li>使用流进行响应
<ul><li>现代浏览器都支持根据流的返回形式来逐步进行页面内容的解析、处理。这就意味着，即使请求的响应没有完全结束，浏览器也可以从手里已有的响应结果中进行页面的解析与渲染。</li></ul></li> <li>业务聚合（BFF 层）</li> <li>...</li></ul> <h2 id="页面解析与处理"><a href="#页面解析与处理" aria-hidden="true" class="header-anchor">#</a> 页面解析与处理</h2> <ul><li><p>资源在页面文档中的位置</p> <ul><li>JS 可以修改 DOM, 也可以修改 CSS。 根据标准规范，在 JavaScript 中可以访问 DOM。因此当遇到 JavaScript 后会阻塞 DOM 的解析。于此同时，为避免 CSS 与 JavaScript 之间的竞态，CSSOM 的构建会阻塞 JavaScript 的脚本执行。</li> <li>在最佳实践中，推荐把 CSS 样式表放在 <code>&lt;head&gt;</code> 之中（即页面的头部），把 JavaScript 脚本放在 <code>&lt;body&gt;</code> 的最后（即页面的尾部）。</li></ul> <p><img src="/tombstone/assets/img/render.bc7e46a4.png" alt="render"></p></li> <li><p>使用 defer 和 async</p> <ul><li>defer 会在 HTML 解析完成后，按照脚本出现的次序再顺序执行；而 async 则是下载完成就立即开始执行，同时阻塞页面解析，不保证脚本间的执行顺序。</li> <li>ubt 脚本一般用 async</li></ul> <p><img src="/tombstone/assets/img/defer.20475382.png" alt="defer"></p></li> <li><p>页面文档压缩（gzip）</p></li></ul> <h2 id="页面静态资源"><a href="#页面静态资源" aria-hidden="true" class="header-anchor">#</a> 页面静态资源</h2> <ul><li>减少不必要的请求
<ul><li>浏览器对同源请求有并发上限的限制（例如 Chrome 是6）（HTTP/1.1）</li> <li>TCP/IP 的拥塞控制也使其传输有慢启动（slow start）的特点，连接刚建立时包体传输速率较低，后续会渐渐提速</li></ul></li> <li>减少包体大小</li> <li>降低应用资源时的消耗
<ul><li>CPU 密集计算</li> <li>频繁 DOM 操作</li></ul></li> <li>利用缓存</li></ul> <h3 id="javascript"><a href="#javascript" aria-hidden="true" class="header-anchor">#</a> JavaScript</h3> <ul><li>减少不必要的请求
<ul><li><p>代码拆分（code split）和按需加载</p> <ul><li>思路</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'/static/js/toload.js'</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>webpack 内 dynamic import</li> <li>AMD(RequireJS)</li></ul></li> <li><p>代码合并</p></li></ul></li> <li>减少包体大小
<ul><li>代码压缩
<ul><li>UglifyJS</li> <li>gizp</li></ul></li> <li>Tree Shaking</li> <li>优化 polyfill 使用
<ul><li>根据浏览器支持情况来下发 polyfill</li></ul></li> <li>webpack
<ul><li>webpack-bundle-analyzer 分析各个模块占用大小</li></ul></li></ul></li></ul> <h2 id="运行时"><a href="#运行时" aria-hidden="true" class="header-anchor">#</a> 运行时</h2> <ul><li>注意强制同步布局
<ul><li>避免修改了 dom 再获取 dom 其他属性</li></ul></li> <li>善用 Composite</li> <li>长列表优化
<ul><li>虚拟列表实现</li></ul></li> <li>滚动事件优化
<ul><li>throttle</li> <li>debounce</li></ul></li> <li>避免 JS 运行事件过长</li></ul> <h2 id="预加载"><a href="#预加载" aria-hidden="true" class="header-anchor">#</a> 预加载</h2> <ul><li>预加载技术
<ul><li><p>Resource Hints</p> <ul><li>DNS Prefetch</li> <li>Preconnect</li> <li>Prefetch
<ul><li><code>&lt;link rel=&quot;prefetch&quot; href=&quot;/prefetch.js&quot; as=&quot;script&quot;&gt;</code></li></ul></li> <li>Prerender
<ul><li><code>&lt;link rel=&quot;prerender&quot; href=&quot;//sample.com/nextpage.html&quot;&gt;</code></li></ul></li> <li>Preload
<ul><li><code>&lt;link rel=&quot;preload&quot; href=&quot;./nextpage.js&quot; as=&quot;script&quot;&gt;</code></li></ul></li></ul> <p>与 Prefetch 相比，Preload 会强制浏览器立即获取资源，并且该请求具有较高的优先级（mandatory and high-priority），因此建议对一些当前页面会马上用到资源使用 Preload；相对的，Prefetch 的资源获取则是可选与较低优先级的，其是否获取完全取决于浏览器的决定，适用于预获取将来可能会用到的资源。</p> <ul><li>在 webpack 中使用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// prefetch</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'./sub1.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// preload</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span> <span class="token string">'./sub2.js'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>基于 JavaScript 的预加载</p> <ul><li>图片(不需要插入页面)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'/static/img/prefetch.jpg'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>JS、CSS(需要通过 script、link 添加到页面)</li></ul></li></ul></li></ul> <h2 id="参考文章"><a href="#参考文章" aria-hidden="true" class="header-anchor">#</a> 参考文章</h2> <ul><li><a href="https://alienzhou.github.io/fe-performance-journey/" target="_blank" rel="noopener noreferrer">前端性能优化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/54cc04190252" target="_blank" rel="noopener noreferrer">深入理解浏览器的缓存机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tombstone/frontend/browser/howbrowserworks.html" class="prev">浏览器是怎么工作的</a></span> <span class="next"><a href="/tombstone/frontend/javascript/howjsworks.html">JS 是怎么工作的</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/tombstone/assets/js/app.d26b1760.js" defer></script><script src="/tombstone/assets/js/2.152d0674.js" defer></script><script src="/tombstone/assets/js/4.42483a9f.js" defer></script>
  </body>
</html>
