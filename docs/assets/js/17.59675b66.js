(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{165:function(a,r,t){"use strict";t.r(r);var e=t(0),s=Object(e.a)({},(function(){var a=this,r=a.$createElement,t=a._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"浏览器同源策略与-ajax-跨域方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#浏览器同源策略与-ajax-跨域方法","aria-hidden":"true"}},[a._v("#")]),a._v(" 浏览器同源策略与 ajax 跨域方法")]),a._v(" "),t("h2",{attrs:{id:"同源策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同源策略","aria-hidden":"true"}},[a._v("#")]),a._v(" 同源策略")]),a._v(" "),t("p",[a._v("url 中 protocol 协议、host 域名、port 端口这三个部分都相同时，就是同源。")]),a._v(" "),t("p",[a._v("同源策略限制是出于安全考虑，以下操作受到限制：")]),a._v(" "),t("ul",[t("li",[a._v("ajax 请求")]),a._v(" "),t("li",[a._v("dom 操作")]),a._v(" "),t("li",[a._v("cookie, localStorage, indexDB 等")])]),a._v(" "),t("p",[a._v("script, style, img, video, audio, iframe 等不收限制")]),a._v(" "),t("h2",{attrs:{id:"ajax-请求跨域方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ajax-请求跨域方法","aria-hidden":"true"}},[a._v("#")]),a._v(" ajax 请求跨域方法")]),a._v(" "),t("h3",{attrs:{id:"使用代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用代理","aria-hidden":"true"}},[a._v("#")]),a._v(" 使用代理")]),a._v(" "),t("p",[a._v("将非同源移到服务端，浏览器端同源")]),a._v(" "),t("h3",{attrs:{id:"cors-cross-origin-resource-sharing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cors-cross-origin-resource-sharing","aria-hidden":"true"}},[a._v("#")]),a._v(" CORS(Cross-Origin Resource Sharing)")]),a._v(" "),t("p",[a._v("发送非同源请求时浏览器会自动带上 Origin 请求头 "),t("code",[a._v("origin: https://m.xxx.com")]),a._v("， 服务端响应带上头信息 "),t("code",[a._v("access-control-allow-origin: https://m.xxx.com")]),a._v("， 即可跨域。如果将 "),t("code",[a._v("Access-Control-Allow-Origin")]),a._v(" 的值设置为 *，则会接受所有域的请求。")]),a._v(" "),t("p",[a._v("响应头 "),t("code",[a._v("Access-Control-Allow-Credentials")]),a._v(" 设为 true 时表示服务器允许该请求内包含cookie信息，Access-Control-Allow-Origin 设置为 * 时无效， 客户端 "),t("code",[a._v("xhr.withCredentials")]),a._v(" 设为 true 即可带上 cookie。")]),a._v(" "),t("p",[t("code",[a._v("Access-Control-Expose-Headers")]),a._v(" 头让服务器把允许浏览器访问的头放入白名单")]),a._v(" "),t("p",[a._v("非简单请求时浏览器会发 OPTIONS 预检请求")]),a._v(" "),t("h3",{attrs:{id:"jsonp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jsonp","aria-hidden":"true"}},[a._v("#")]),a._v(" JSONP")]),a._v(" "),t("p",[a._v("步骤：")]),a._v(" "),t("ol",[t("li",[a._v("客户端定义全局的回调函数 callback_uid")]),a._v(" "),t("li",[a._v("动态创建 script, src 为 "),t("code",[a._v("https://api.xxx.com/getproductinfo/jsonp?cb=callback_uid")])]),a._v(" "),t("li",[a._v("服务端响应数据用 callback_uid 包裹， "),t("code",[a._v("callback_uid(dataString)")])]),a._v(" "),t("li",[a._v("客户端收到响应后会执行 callback_uid，执行后清理掉 callback_uid 和 script。")])])])}),[],!1,null,null,null);r.default=s.exports}}]);